"""
SDU AI Agent â€” RAG Evaluation Runner

à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸à¸²à¸£à¸£à¸±à¸™ evaluation pipeline à¹‚à¸”à¸¢à¹ƒà¸Šà¹‰:
  1. Test cases à¸ªà¸³à¸«à¸£à¸±à¸šà¸—à¸”à¸ªà¸­à¸š (à¹ƒà¸Šà¹‰à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸³à¸¥à¸­à¸‡ + à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸£à¸´à¸‡à¸ˆà¸²à¸ ChromaDB)
  2. SmartBrain à¸ªà¸³à¸«à¸£à¸±à¸š retrieve & generate
  3. RAGEvaluator à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸£à¸°à¹€à¸¡à¸´à¸™à¸œà¸¥

Usage:
    python3 -m evaluation.run_evaluation
"""

from __future__ import annotations

import os
import sys
import json

# Ensure project root is on sys.path
PROJECT_ROOT = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))
if PROJECT_ROOT not in sys.path:
    sys.path.insert(0, PROJECT_ROOT)

from evaluation.evaluator import RAGEvaluator
from evaluation.metrics import RetrievalMetrics
from evaluation.statistical_analysis import DescriptiveStats, BootstrapCI


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Sample test cases (à¸ˆà¸³à¸¥à¸­à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸ªà¸²à¸˜à¸´à¸•à¸£à¸°à¸šà¸š)
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

SAMPLE_TEST_CASES = [
    {
        "query": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹„à¸«à¸™",
        "reference_answer": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¸•à¸±à¹‰à¸‡à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹€à¸‚à¸•à¸”à¸¸à¸ªà¸´à¸• à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¡à¸«à¸²à¸™à¸„à¸£",
        "relevant_ids": ["location_doc_0", "location_doc_1", "about_doc_0"],
        "retrieved_ids": ["location_doc_0", "history_doc_2", "location_doc_1", "about_doc_0", "course_doc_3"],
        "context_chunks": [
            "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¸•à¸±à¹‰à¸‡à¸­à¸¢à¸¹à¹ˆà¹€à¸¥à¸‚à¸—à¸µà¹ˆ 295 à¸–à¸™à¸™à¸™à¸„à¸£à¸£à¸²à¸Šà¸ªà¸µà¸¡à¸² à¹€à¸‚à¸•à¸”à¸¸à¸ªà¸´à¸• à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¡à¸«à¸²à¸™à¸„à¸£ 10300",
            "à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¹€à¸”à¸´à¸¡à¹€à¸›à¹‡à¸™à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™",
            "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¸¡à¸µà¸—à¸µà¹ˆà¸•à¸±à¹‰à¸‡à¸«à¸¥à¸±à¸à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹€à¸‚à¸•à¸”à¸¸à¸ªà¸´à¸• à¹ƒà¸à¸¥à¹‰à¸à¸±à¸šà¸žà¸£à¸°à¸•à¸³à¸«à¸™à¸±à¸à¸ªà¸§à¸™à¸ˆà¸´à¸•à¸£à¸¥à¸”à¸²",
        ],
        "generated_answer": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸•à¸±à¹‰à¸‡à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹€à¸‚à¸•à¸”à¸¸à¸ªà¸´à¸• à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¡à¸«à¸²à¸™à¸„à¸£ à¹€à¸¥à¸‚à¸—à¸µà¹ˆ 295 à¸–à¸™à¸™à¸™à¸„à¸£à¸£à¸²à¸Šà¸ªà¸µà¸¡à¸² à¸„à¸£à¸±à¸š",
    },
    {
        "query": "à¸„à¸“à¸°à¸—à¸µà¹ˆà¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¹ƒà¸™à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸­à¸°à¹„à¸£à¸šà¹‰à¸²à¸‡",
        "reference_answer": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¸«à¸¥à¸²à¸¢à¸„à¸“à¸° à¹€à¸Šà¹ˆà¸™ à¸„à¸“à¸°à¸„à¸£à¸¸à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ à¸„à¸“à¸°à¸¡à¸™à¸¸à¸©à¸¢à¸¨à¸²à¸ªà¸•à¸£à¹Œà¹à¸¥à¸°à¸ªà¸±à¸‡à¸„à¸¡à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¹à¸¥à¸°à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µ à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™",
        "relevant_ids": ["faculty_doc_0", "faculty_doc_1", "faculty_doc_2"],
        "retrieved_ids": ["faculty_doc_0", "admission_doc_1", "faculty_doc_2", "schedule_doc_0", "faculty_doc_1"],
        "context_chunks": [
            "à¸„à¸“à¸°à¸„à¸£à¸¸à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ à¸„à¸“à¸°à¸¡à¸™à¸¸à¸©à¸¢à¸¨à¸²à¸ªà¸•à¸£à¹Œà¹à¸¥à¸°à¸ªà¸±à¸‡à¸„à¸¡à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¹à¸¥à¸°à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µ",
            "à¸à¸²à¸£à¸£à¸±à¸šà¸ªà¸¡à¸±à¸„à¸£à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²à¹ƒà¸«à¸¡à¹ˆ à¸›à¸£à¸°à¸ˆà¸³à¸›à¸µà¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² 2568",
            "à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™ à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¹€à¸›à¹‡à¸™à¸•à¹‰à¸™à¸à¸³à¹€à¸™à¸´à¸”à¸‚à¸­à¸‡à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢",
        ],
        "generated_answer": "à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¸«à¸¥à¸²à¸¢à¸„à¸“à¸°à¸„à¸£à¸±à¸š à¹€à¸Šà¹ˆà¸™ à¸„à¸“à¸°à¸„à¸£à¸¸à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸à¸²à¸£à¸ˆà¸±à¸”à¸à¸²à¸£ à¸„à¸“à¸°à¸¡à¸™à¸¸à¸©à¸¢à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸¯ à¸„à¸“à¸°à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸¯ à¹à¸¥à¸°à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™ à¸„à¸£à¸±à¸š",
    },
    {
        "query": "à¸„à¹ˆà¸²à¹€à¸—à¸­à¸¡à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ",
        "reference_answer": "à¸„à¹ˆà¸²à¹€à¸—à¸­à¸¡à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸‚à¸¶à¹‰à¸™à¸­à¸¢à¸¹à¹ˆà¸à¸±à¸šà¸„à¸“à¸°à¹à¸¥à¸°à¸ªà¸²à¸‚à¸²à¸§à¸´à¸Šà¸² à¹‚à¸”à¸¢à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸›à¸£à¸°à¸¡à¸²à¸“ 15,000-25,000 à¸šà¸²à¸—à¸•à¹ˆà¸­à¹€à¸—à¸­à¸¡",
        "relevant_ids": ["tuition_doc_0", "tuition_doc_1"],
        "retrieved_ids": ["admission_doc_0", "tuition_doc_0", "scholarship_doc_0", "tuition_doc_1", "about_doc_2"],
        "context_chunks": [
            "à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸£à¸±à¸šà¸ªà¸¡à¸±à¸„à¸£à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²à¹ƒà¸«à¸¡à¹ˆ",
            "à¸„à¹ˆà¸²à¸˜à¸£à¸£à¸¡à¹€à¸™à¸µà¸¢à¸¡à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸² à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¹à¸šà¹ˆà¸‡à¸•à¸²à¸¡à¸„à¸“à¸° à¸›à¸£à¸°à¸¡à¸²à¸“ 15,000-25,000 à¸šà¸²à¸—à¸•à¹ˆà¸­à¸ à¸²à¸„à¹€à¸£à¸µà¸¢à¸™",
            "à¸—à¸¸à¸™à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²à¸ªà¸³à¸«à¸£à¸±à¸šà¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²à¸—à¸µà¹ˆà¸¡à¸µà¸œà¸¥à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸™à¸”à¸µà¹€à¸”à¹ˆà¸™",
        ],
        "generated_answer": "à¸„à¹ˆà¸²à¹€à¸—à¸­à¸¡à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸‚à¸¶à¹‰à¸™à¸­à¸¢à¸¹à¹ˆà¸à¸±à¸šà¸„à¸“à¸°à¸„à¸£à¸±à¸š à¹‚à¸”à¸¢à¹€à¸‰à¸¥à¸µà¹ˆà¸¢à¸›à¸£à¸°à¸¡à¸²à¸“ 15,000-25,000 à¸šà¸²à¸—à¸•à¹ˆà¸­à¹€à¸—à¸­à¸¡",
    },
    {
        "query": "à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸«à¸­à¸žà¸±à¸à¹„à¸«à¸¡",
        "reference_answer": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸«à¸­à¸žà¸±à¸à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£à¸ªà¸³à¸«à¸£à¸±à¸šà¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²",
        "relevant_ids": ["dormitory_doc_0"],
        "retrieved_ids": ["campus_doc_0", "campus_doc_1", "about_doc_0", "history_doc_0", "event_doc_0"],
        "context_chunks": [
            "à¸ªà¸´à¹ˆà¸‡à¸­à¸³à¸™à¸§à¸¢à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸à¸ à¸²à¸¢à¹ƒà¸™à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢ à¹„à¸”à¹‰à¹à¸à¹ˆ à¸«à¹‰à¸­à¸‡à¸ªà¸¡à¸¸à¸” à¸¨à¸¹à¸™à¸¢à¹Œà¸­à¸²à¸«à¸²à¸£",
            "à¸­à¸²à¸„à¸²à¸£à¹€à¸£à¸µà¸¢à¸™à¹à¸¥à¸°à¸ªà¸´à¹ˆà¸‡à¸­à¸³à¸™à¸§à¸¢à¸„à¸§à¸²à¸¡à¸ªà¸°à¸”à¸§à¸",
            "à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•",
        ],
        "generated_answer": "à¸‚à¸­à¸­à¸ à¸±à¸¢à¸„à¸£à¸±à¸š à¸žà¸µà¹ˆà¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸­à¸žà¸±à¸à¹ƒà¸™à¸£à¸°à¸šà¸šà¸„à¸£à¸±à¸š à¹à¸™à¸°à¸™à¸³à¹ƒà¸«à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­à¸ªà¸­à¸šà¸–à¸²à¸¡à¸—à¸µà¹ˆà¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¹‚à¸”à¸¢à¸•à¸£à¸‡à¸„à¸£à¸±à¸š",
    },
    {
        "query": "à¸ªà¸¡à¸±à¸„à¸£à¹€à¸£à¸µà¸¢à¸™à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¢à¸±à¸‡à¹„à¸‡",
        "reference_answer": "à¸ªà¸²à¸¡à¸²à¸£à¸–à¸ªà¸¡à¸±à¸„à¸£à¸œà¹ˆà¸²à¸™à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œà¸‚à¸­à¸‡à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢ à¸«à¸£à¸·à¸­à¸ªà¸¡à¸±à¸„à¸£à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡à¸—à¸µà¹ˆà¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•",
        "relevant_ids": ["admission_doc_0", "admission_doc_1", "admission_doc_2"],
        "retrieved_ids": ["admission_doc_0", "admission_doc_1", "tuition_doc_0", "admission_doc_2", "faculty_doc_0"],
        "context_chunks": [
            "à¸à¸²à¸£à¸£à¸±à¸šà¸ªà¸¡à¸±à¸„à¸£à¸™à¸±à¸à¸¨à¸¶à¸à¸©à¸²à¹ƒà¸«à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸³à¹€à¸™à¸´à¸™à¸à¸²à¸£à¸œà¹ˆà¸²à¸™à¹€à¸§à¹‡à¸šà¹„à¸‹à¸•à¹Œ www.dusit.ac.th",
            "à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¸à¸²à¸£à¸ªà¸¡à¸±à¸„à¸£à¹€à¸£à¸µà¸¢à¸™: 1) à¸ªà¸¡à¸±à¸„à¸£à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œ 2) à¸ªà¸¡à¸±à¸„à¸£à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡ à¸“ à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢",
            "à¸„à¹ˆà¸²à¸˜à¸£à¸£à¸¡à¹€à¸™à¸µà¸¢à¸¡à¸à¸²à¸£à¸¨à¸¶à¸à¸©à¸²",
        ],
        "generated_answer": "à¸ªà¸¡à¸±à¸„à¸£à¹€à¸£à¸µà¸¢à¸™à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¹„à¸”à¹‰ 2 à¸Šà¹ˆà¸­à¸‡à¸—à¸²à¸‡à¸„à¸£à¸±à¸š à¸ªà¸¡à¸±à¸„à¸£à¸­à¸­à¸™à¹„à¸¥à¸™à¹Œà¸—à¸µà¹ˆ www.dusit.ac.th à¸«à¸£à¸·à¸­à¸ªà¸¡à¸±à¸„à¸£à¸”à¹‰à¸§à¸¢à¸•à¸™à¹€à¸­à¸‡à¸—à¸µà¹ˆà¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¹€à¸¥à¸¢à¸„à¸£à¸±à¸š",
    },
    {
        "query": "à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸ªà¸²à¸‚à¸²à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸à¸²à¸£à¸­à¸²à¸«à¸²à¸£à¹„à¸«à¸¡",
        "reference_answer": "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸”à¹‰à¸²à¸™à¸§à¸´à¸—à¸¢à¸²à¸¨à¸²à¸ªà¸•à¸£à¹Œà¸à¸²à¸£à¸­à¸²à¸«à¸²à¸£ à¹‚à¸”à¸¢à¹€à¸‰à¸žà¸²à¸°à¸ˆà¸²à¸à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆà¸¡à¸µà¸Šà¸·à¹ˆà¸­à¹€à¸ªà¸µà¸¢à¸‡",
        "relevant_ids": ["food_sci_doc_0", "culinary_doc_0"],
        "retrieved_ids": ["culinary_doc_0", "food_sci_doc_0", "faculty_doc_1", "about_doc_0", "history_doc_1"],
        "context_chunks": [
            "à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™ à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸„à¸«à¸à¸£à¸£à¸¡à¸¨à¸²à¸ªà¸•à¸£à¹Œ à¹à¸¥à¸°à¸­à¸¸à¸•à¸ªà¸²à¸«à¸à¸£à¸£à¸¡à¸­à¸²à¸«à¸²à¸£",
            "à¸ªà¸²à¸‚à¸²à¸§à¸´à¸Šà¸²à¹€à¸—à¸„à¹‚à¸™à¹‚à¸¥à¸¢à¸µà¸à¸²à¸£à¸›à¸£à¸°à¸à¸­à¸šà¸­à¸²à¸«à¸²à¸£à¹à¸¥à¸°à¸à¸²à¸£à¸šà¸£à¸´à¸à¸²à¸£",
            "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸• à¸¡à¸µà¸ˆà¸¸à¸”à¹€à¸”à¹ˆà¸™à¸”à¹‰à¸²à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™à¹à¸¥à¸°à¸­à¸²à¸«à¸²à¸£",
        ],
        "generated_answer": "à¸¡à¸µà¸„à¸£à¸±à¸š à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸Šà¸·à¹ˆà¸­à¹€à¸ªà¸µà¸¢à¸‡à¸”à¹‰à¸²à¸™à¸­à¸²à¸«à¸²à¸£à¸¡à¸²à¸à¸„à¸£à¸±à¸š à¹‚à¸”à¸¢à¹€à¸‰à¸žà¸²à¸°à¹‚à¸£à¸‡à¹€à¸£à¸µà¸¢à¸™à¸à¸²à¸£à¹€à¸£à¸·à¸­à¸™à¸—à¸µà¹ˆà¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸„à¸«à¸à¸£à¸£à¸¡à¸¨à¸²à¸ªà¸•à¸£à¹Œà¹à¸¥à¸°à¸­à¸¸à¸•à¸ªà¸²à¸«à¸à¸£à¸£à¸¡à¸­à¸²à¸«à¸²à¸£à¸„à¸£à¸±à¸š",
    },
]


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Live evaluation with SmartBrain
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def create_live_test_cases(queries: list[str], brain) -> list[dict]:
    """
    Run queries through SmartBrain and build test cases for evaluation.
    (Does NOT produce reference_answers or relevant_ids â€” those require human labels.)
    """
    test_cases = []
    for query in queries:
        candidates = brain.retrieve(query, top_k=10)
        reranked = brain.rerank(query, candidates, top_n=5)
        context = [c["text"] for c in reranked]
        context_str = "\n\n".join(
            f"[à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸ˆà¸²à¸: {c['metadata'].get('source', 'Unknown')}]\n{c['text']}"
            for c in reranked
        )
        result = brain.think(query, context_str)

        test_cases.append({
            "query": query,
            "reference_answer": "",
            "relevant_ids": [],
            "retrieved_ids": [f"{c['metadata'].get('source', 'Unknown')}_{c['metadata'].get('chunk_id', 0)}" for c in reranked],
            "context_chunks": context,
            "generated_answer": result["text"] if isinstance(result, dict) else result,
        })
    return test_cases


# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# Main
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

def main():
    import argparse

    parser = argparse.ArgumentParser(description="SDU AI Agent â€” RAG Evaluation")
    parser.add_argument("--mode", choices=["sample", "live"], default="sample",
                        help="'sample' uses built-in test cases; 'live' queries SmartBrain")
    parser.add_argument("--no-semantic", action="store_true",
                        help="Skip semantic metrics (no API calls)")
    parser.add_argument("--k", type=int, default=5, help="Cut-off K for retrieval metrics")
    parser.add_argument("--save", type=str, default="evaluation/report.json",
                        help="Path to save the JSON report")
    args = parser.parse_args()

    print("\nðŸš€ Starting RAG Evaluation...\n")

    if args.mode == "live":
        from src.core.brain import SmartBrain

        brain = SmartBrain()
        queries = [
            "à¸¡à¸«à¸²à¸§à¸´à¸—à¸¢à¸²à¸¥à¸±à¸¢à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸­à¸¢à¸¹à¹ˆà¸—à¸µà¹ˆà¹„à¸«à¸™",
            "à¸„à¸“à¸°à¸—à¸µà¹ˆà¹€à¸›à¸´à¸”à¸ªà¸­à¸™à¸¡à¸µà¸­à¸°à¹„à¸£à¸šà¹‰à¸²à¸‡",
            "à¸„à¹ˆà¸²à¹€à¸—à¸­à¸¡à¹€à¸—à¹ˆà¸²à¹„à¸«à¸£à¹ˆ",
            "à¸ªà¸¡à¸±à¸„à¸£à¹€à¸£à¸µà¸¢à¸™à¸¢à¸±à¸‡à¹„à¸‡",
            "à¸ªà¸§à¸™à¸”à¸¸à¸ªà¸´à¸•à¸¡à¸µà¸ˆà¸¸à¸”à¹€à¸”à¹ˆà¸™à¸­à¸°à¹„à¸£",
        ]
        test_cases = create_live_test_cases(queries, brain)
        print(f"âœ… Generated {len(test_cases)} live test cases.\n")
    else:
        test_cases = SAMPLE_TEST_CASES
        print(f"âœ… Using {len(test_cases)} sample test cases.\n")

    run_semantic = not args.no_semantic
    evaluator = RAGEvaluator()

    report = evaluator.evaluate(
        test_cases,
        k=args.k,
        run_semantic=run_semantic,
    )

    RAGEvaluator.print_report(report)
    RAGEvaluator.save_report(report, args.save)

    # â”€â”€ Quick retrieval-only demo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    print("\nâ•â•â• Retrieval Metrics â€” Quick Demo â•â•â•")
    for i, tc in enumerate(test_cases):
        r = report["per_query_retrieval"][i]
        print(f"\n  Q{i+1}: {tc['query'][:50]}...")
        for metric, val in r.items():
            print(f"    {metric:>20s}: {val:.4f}")


if __name__ == "__main__":
    main()
